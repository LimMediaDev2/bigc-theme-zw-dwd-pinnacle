{"version":3,"file":"theme-bundle.chunk.947.js","mappings":"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","sources":["webpack://Pinnacle/./assets/js/theme/common/url-utils.js","webpack://Pinnacle/./assets/js/theme/search.js"],"sourcesContent":["import $ from 'jquery';\nimport Url from 'url';\n\nconst urlUtils = {\n    getUrl: () => `${window.location.pathname}${window.location.search}`,\n\n    goToUrl: (url) => {\n        window.history.pushState({}, document.title, url);\n        $(window).trigger('statechange');\n    },\n\n    replaceParams: (url, params) => {\n        const parsed = Url.parse(url, true);\n        let param;\n\n        // Let the formatter use the query object to build the new url\n        parsed.search = null;\n\n        for (param in params) {\n            if (params.hasOwnProperty(param)) {\n                parsed.query[param] = params[param];\n            }\n        }\n\n        return Url.format(parsed);\n    },\n\n    buildQueryString: (queryData) => {\n        let out = '';\n        let key;\n        for (key in queryData) {\n            if (queryData.hasOwnProperty(key)) {\n                if (Array.isArray(queryData[key])) {\n                    let ndx;\n\n                    for (ndx in queryData[key]) {\n                        if (queryData[key].hasOwnProperty(ndx)) {\n                            out += `&${key}=${queryData[key][ndx]}`;\n                        }\n                    }\n                } else {\n                    out += `&${key}=${queryData[key]}`;\n                }\n            }\n        }\n\n        return out.substring(1);\n    },\n\n    parseQueryParams: (queryData) => {\n        const params = {};\n\n        for (let i = 0; i < queryData.length; i++) {\n            const temp = queryData[i].split('=');\n\n            if (temp[0] in params) {\n                if (Array.isArray(params[temp[0]])) {\n                    params[temp[0]].push(temp[1]);\n                } else {\n                    params[temp[0]] = [params[temp[0]], temp[1]];\n                }\n            } else {\n                params[temp[0]] = temp[1];\n            }\n        }\n\n        return params;\n    },\n};\n\nexport default urlUtils;\n","import { hooks } from '@bigcommerce/stencil-utils';\nimport CatalogPage from './catalog';\nimport $ from 'jquery';\nimport FacetedSearch from './common/faceted-search';\nimport compareProducts from './global/compare-products';\nimport urlUtils from './common/url-utils';\nimport Url from 'url';\nimport collapsibleFactory from './common/collapsible';\nimport 'jstree';\nimport nod from './common/nod';\n\nexport default class Search extends CatalogPage {\n    formatCategoryTreeForJSTree(node) {\n        const nodeData = {\n            text: node.data,\n            id: node.metadata.id,\n            state: {\n                selected: node.selected,\n            },\n        };\n\n        if (node.state) {\n            nodeData.state.opened = node.state === 'open';\n            nodeData.children = true;\n        }\n\n        if (node.children) {\n            nodeData.children = [];\n            node.children.forEach((childNode) => {\n                nodeData.children.push(this.formatCategoryTreeForJSTree(childNode));\n            });\n        }\n\n        return nodeData;\n    }\n\n    showProducts(navigate = true) {\n        this.$productListingContainer.removeClass('u-hiddenVisually');\n        this.$facetedSearchContainer.removeClass('u-hiddenVisually');\n        this.$contentResultsContainer.addClass('u-hiddenVisually');\n\n        $('[data-content-results-toggle]').removeClass('navBar-action-color--active');\n        $('[data-content-results-toggle]').addClass('navBar-action');\n\n        $('[data-product-results-toggle]').removeClass('navBar-action');\n        $('[data-product-results-toggle]').addClass('navBar-action-color--active');\n\n        if (!navigate) {\n            return;\n        }\n\n        const searchData = $('#search-results-product-count span').data();\n        const url = (searchData.count > 0) ? searchData.url : urlUtils.replaceParams(searchData.url, {\n            page: 1,\n        });\n\n        urlUtils.goToUrl(url);\n    }\n\n    showContent(navigate = true) {\n        this.$contentResultsContainer.removeClass('u-hiddenVisually');\n        this.$productListingContainer.addClass('u-hiddenVisually');\n        this.$facetedSearchContainer.addClass('u-hiddenVisually');\n\n        $('[data-product-results-toggle]').removeClass('navBar-action-color--active');\n        $('[data-product-results-toggle]').addClass('navBar-action');\n\n        $('[data-content-results-toggle]').removeClass('navBar-action');\n        $('[data-content-results-toggle]').addClass('navBar-action-color--active');\n\n        if (!navigate) {\n            return;\n        }\n\n        const searchData = $('#search-results-content-count span').data();\n        const url = (searchData.count > 0) ? searchData.url : urlUtils.replaceParams(searchData.url, {\n            page: 1,\n        });\n\n        urlUtils.goToUrl(url);\n    }\n\n    onReady() {\n        compareProducts(this.context.urls);\n\n        const $searchForm = $('[data-advanced-search-form]');\n        const $categoryTreeContainer = $searchForm.find('[data-search-category-tree]');\n        const url = Url.parse(window.location.href, true);\n        const treeData = [];\n        this.$productListingContainer = $('#product-listing-container');\n        this.$facetedSearchContainer = $('#faceted-search-container');\n        this.$contentResultsContainer = $('#search-results-content');\n\n        // Init faceted search\n        if ($('#facetedSearch').length > 0) {\n            this.initFacetedSearch();\n        } else {\n            this.onSortBySubmit = this.onSortBySubmit.bind(this);\n            hooks.on('sortBy-submitted', this.onSortBySubmit);\n        }\n\n        // Init collapsibles\n        collapsibleFactory();\n\n        $('[data-product-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showProducts();\n        });\n\n        $('[data-content-results-toggle]').on('click', event => {\n            event.preventDefault();\n            this.showContent();\n        });\n\n        if (this.$productListingContainer.find('li.product').length === 0 || url.query.section === 'content') {\n            this.showContent(false);\n        } else {\n            this.showProducts(false);\n        }\n\n        const validator = this.initValidation($searchForm)\n            .bindValidation($searchForm.find('#search_query_adv'));\n\n        this.context.categoryTree.forEach((node) => {\n            treeData.push(this.formatCategoryTreeForJSTree(node));\n        });\n\n        this.categoryTreeData = treeData;\n        this.createCategoryTree($categoryTreeContainer);\n\n        $searchForm.on('submit', event => {\n            const selectedCategoryIds = $categoryTreeContainer.jstree().get_selected();\n\n            if (!validator.check()) {\n                return event.preventDefault();\n            }\n\n            $searchForm.find('input[name=\"category\\[\\]\"]').remove();\n\n            for (const categoryId of selectedCategoryIds) {\n                const input = $('<input>', {\n                    type: 'hidden',\n                    name: 'category[]',\n                    value: categoryId,\n                });\n\n                $searchForm.append(input);\n            }\n        });\n    }\n\n    loadTreeNodes(node, cb) {\n        $.ajax({\n            url: '/remote/v1/category-tree',\n            data: {\n                selectedCategoryId: node.id,\n                prefix: 'category',\n            },\n            headers: {\n                'x-xsrf-token': window.BCData && window.BCData.csrf_token ? window.BCData.csrf_token : '',\n            },\n        }).done(data => {\n            const formattedResults = [];\n\n            data.forEach((dataNode) => {\n                formattedResults.push(this.formatCategoryTreeForJSTree(dataNode));\n            });\n\n            cb(formattedResults);\n        });\n    }\n\n    createCategoryTree($container) {\n        const treeOptions = {\n            core: {\n                data: (node, cb) => {\n                    // Root node\n                    if (node.id === '#') {\n                        cb(this.categoryTreeData);\n                    } else {\n                        // Lazy loaded children\n                        this.loadTreeNodes(node, cb);\n                    }\n                },\n                themes: {\n                    icons: true,\n                },\n            },\n            checkbox: {\n                three_state: false,\n            },\n            plugins: [\n                'checkbox',\n            ],\n        };\n\n        $container.jstree(treeOptions);\n    }\n\n    initFacetedSearch() {\n        const $productListingContainer = $('#product-listing-container');\n        const $contentListingContainer = $('#search-results-content');\n        const $facetedSearchContainer = $('#faceted-search-container');\n        const $searchHeading = $('#search-results-heading');\n        const $searchCount = $('#search-results-product-count');\n        const $contentCount = $('#search-results-content-count');\n        const productsPerPage = this.context.searchProductsPerPage;\n        const requestOptions = {\n            template: {\n                productListing: 'search/product-listing',\n                contentListing: 'search/content-listing',\n                sidebar: 'search/sidebar',\n                heading: 'search/heading',\n                productCount: 'search/product-count',\n                contentCount: 'search/content-count',\n            },\n            config: {\n                product_results: {\n                    limit: productsPerPage,\n                },\n            },\n            showMore: 'search/show-more',\n        };\n\n        this.facetedSearch = new FacetedSearch(requestOptions, (content) => {\n            $searchHeading.html(content.heading);\n\n            const url = Url.parse(window.location.href, true);\n            if (url.query.section === 'content') {\n                $contentListingContainer.html(content.contentListing);\n                $contentCount.html(content.contentCount);\n                this.showContent(false);\n            } else {\n                $productListingContainer.html(content.productListing);\n                $facetedSearchContainer.html(content.sidebar);\n                $searchCount.html(content.productCount);\n                this.showProducts(false);\n            }\n\n            $('body').triggerHandler('compareReset');\n\n            $('html, body').animate({\n                scrollTop: 0,\n            }, 100);\n        });\n    }\n\n    initValidation($form) {\n        this.$form = $form;\n        this.validator = nod({\n            submit: $form,\n        });\n\n        return this;\n    }\n\n    bindValidation($element) {\n        if (this.validator) {\n            this.validator.add({\n                selector: $element,\n                validate: 'presence',\n                errorMessage: $element.data('errorMessage'),\n            });\n        }\n\n        return this;\n    }\n\n    check() {\n        if (this.validator) {\n            this.validator.performCheck();\n            return this.validator.areAll('valid');\n        }\n\n        return false;\n    }\n}\n"],"names":["url","window","history","pushState","document","title","$","trigger","params","param","parsed","Url","search","hasOwnProperty","query","Search","_CatalogPage","apply","arguments","_proto","prototype","formatCategoryTreeForJSTree","node","_this","nodeData","text","data","id","metadata","state","selected","opened","children","forEach","childNode","push","showProducts","navigate","this","$productListingContainer","removeClass","$facetedSearchContainer","$contentResultsContainer","addClass","searchData","count","urlUtils","page","showContent","onReady","_this2","compareProducts","context","urls","$searchForm","$categoryTreeContainer","find","location","href","treeData","length","initFacetedSearch","onSortBySubmit","bind","hooks","on","collapsibleFactory","event","preventDefault","section","validator","initValidation","bindValidation","categoryTree","categoryTreeData","createCategoryTree","selectedCategoryIds","jstree","get_selected","check","remove","_step","_iterator","_createForOfIteratorHelperLoose","done","categoryId","value","input","type","name","append","loadTreeNodes","cb","_this3","selectedCategoryId","prefix","headers","BCData","csrf_token","formattedResults","dataNode","$container","_this4","treeOptions","core","themes","icons","checkbox","three_state","plugins","_this5","$contentListingContainer","$searchHeading","$searchCount","$contentCount","requestOptions","template","productListing","contentListing","sidebar","heading","productCount","contentCount","config","product_results","limit","searchProductsPerPage","showMore","facetedSearch","FacetedSearch","content","html","triggerHandler","animate","scrollTop","$form","nod","submit","$element","add","selector","validate","errorMessage","performCheck","areAll","CatalogPage"],"sourceRoot":""}